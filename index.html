<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="main.css">
    <link type="text/css" src="./dist/bttn.min.css" />
</head>

<body>
    <!-- <body onload='loadpendingtodolist()'>-->
    <!--  <body onload='loadtodolist()'>
    <div class="flex-container">
        <p>
          <input id="new-task" type="text" class="newinput">
          <button id ="add-button" class="addbutton"><img src="add.svg" id = "addimage" class = "addimage"></button>
          <button onclick="location.href='https://assistant.google.com/services/a/uid/000000864377308f'" id ="assist-button" class="addbutton"><img src="assist.svg" id = "assistimage" class = "addimage"></button>
          <button id ="signout-button" class="signoutbutton" onclick="AppSignout()"><img src="signout.svg" id = "signoutimage" class = "signoutimage"></button>
        </p>
        <ul id="incomplete-tasks">
        </ul>
        <p>
        <button id ="show-complete-button" class="showcompletedbutton" onclick="loadcompletedtodolist()">Show Completed Tasks</button>
        </p>
        <ul id="completed-tasks">
        </ul>
        <p>
          <button id ="show-future-button" class="showcompletedbutton" onclick="loadfuturetodolist()">Show Future Tasks</button>
        </p>
        <ul id="future-tasks">
        </ul>
      </div>
-->
    <button style="font-size:90px;" onclick="authenticate().then(loadClient).then(execute).then(past8execute).then(past45execute).then(pastmorethan45execute).then(future8execute).then(future45execute).then(future123execute).then(future360execute).then(futureexecute)">Load Google Tasks</button>
    <p id="tasklog" style="font-size:70px;"></p>
    <p id="futuretasklog" style="font-size:70px;"></p>
    
    <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="firebase-app.js"></script>
    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="firebase-analytics.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="firebase-auth.js"></script>
    <script src="firebase-firestore.js"></script>
    <script src="chrono.min.js"></script>
    <!--<script type="text/javascript" src="app.js"></script>-->
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        ///google tasks api
          var config = {
                        apiKey: "AIzaSyAQ--7BYrBnmjsdX8LvNIOu8uIE7alDsAE",
                        authDomain: "listspeaker.firebaseapp.com",
                        databaseURL: "https://listspeaker.firebaseio.com",
                        projectId: "listspeaker",
                        storageBucket: "listspeaker.appspot.com",
                        messagingSenderId: "576657502351"
                    };
                    firebase.initializeApp(config);
        
        function authenticate() {
            return gapi.auth2.getAuthInstance()
                .signIn({ scope: "https://www.googleapis.com/auth/tasks.readonly" })
                .then(function () { console.log("Sign-in successful"); },
                    function (err) { console.error("Error signing in", err); });
        }
        function loadClient() {
            gapi.client.setApiKey("AIzaSyAQ--7BYrBnmjsdX8LvNIOu8uIE7alDsAE");
            return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/tasks/v1/rest")
                .then(function () { console.log("GAPI client loaded for API"); },
                    function (err) { console.error("Error loading GAPI client for API", err); });
        }
        // Make sure the client is loaded and sign-in is complete before calling this method.
        function execute() {
            tomorrowB.setDate(tomorrowB.getDate() - 2);
            tomorrowE.setDate(tomorrowB.getDate() + 1);

            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrow.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                    db.collection("tasks").where("uemail", "==", useremail).where("status", "==", false).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 6000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                        document.getElementById("tasklog").innerHTML = 'Loaded active and pending tasks within last 3 days';

                    } else {
                   document.getElementById("tasklog").innerHTML = 'NOT loaded - active and pending tasks';
                        console.log('No task lists found.');
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
        
                function past8execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() - 8);
            tomorrowE.setDate(tomorrowB.getDate() - 2);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded pending tasks within last 8 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
 
                function past45execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() - 45);
            tomorrowE.setDate(tomorrowB.getDate() - 8);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded pending tasks within last 45 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
 
              function pastmorethan45execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowE.setDate(tomorrowB.getDate() - 45);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded pending tasks that are more than 45 days old';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
        
                  function future8execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() + 1);
            tomorrowE.setDate(tomorrowB.getDate() + 8);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded Future Tasks < 8 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
    
        
        function future45execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() + 8);
            tomorrowE.setDate(tomorrowB.getDate() + 45);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded Future Tasks < 45 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
 
               function future123execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() + 45);
            tomorrowE.setDate(tomorrowB.getDate() + 123);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded Future Tasks < 123 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
 
                 function future360execute() {
                 var tomorrowB = new Date();
                 var tomorrowE = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowB.setDate(tomorrowB.getDate() + 123);
            tomorrowE.setDate(tomorrowB.getDate() + 360);
                      
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowB.toISOString(),
                "dueMax": tomorrowE.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded Future Tasks < 360 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
 
          function futureexecute() {
                 var tomorrowd = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrowd.setDate(tomorrowd.getDate() + 360);
            return gapi.client.tasks.tasks.list({
                "tasklist": "@default",
                "dueMin": tomorrowd.toISOString(),
                "maxResults": 10000,
                "showCompleted": false,
                "showDeleted": false
            })
                .then(async function (response) {
                    // var gtasks = JSON.parse(response.result)
                    // Handle the results here (response.result has the parsed body).  
                  
                    var useremail = null;
                    var db;
                    firebase.auth().onAuthStateChanged(user => {
                        if (user) {
                            useremail = user.email; console.log('logged in' + user.uid + ' email  ' + user.email);
                            db = firebase.firestore();
                        }
                        else {
                            console.log('NOT logged in');
                            window.location = 'signin.html';
                        }
                    });
                    await new Promise(r => setTimeout(r, 2000));
                     var tomorrow = new Date();
            // Subsequent queries will use persistence, if it was enabled successfully
            //Handle Account Status
            tomorrow.setDate(tomorrow.getDate() + 1);
                    db.collection("tasks").where("uemail", "==", useremail).where("dueDate", ">", tomorrow).get()
                        .then((querySnapshot) => {
                            querySnapshot.forEach((doc) => {
                                console.log('delete   - ' + doc.data().title);
                                db.collection("tasks").doc(doc.id).delete().then(function () {
                                    console.log("Document successfully deleted!");
                                }).catch(function (error) {
                                    console.error("Error removing document: ", error);
                                });
                            });
                        });
                   await new Promise(r => setTimeout(r, 4000));
                    console.log("Response", response);
                    var taskLists = response.result.items;
                    if (taskLists && taskLists.length > 0) {
                        for (var i = 0; i < taskLists.length; i++) {
                            var taskList = taskLists[i];
                            console.log(i + ' . ' + taskList.title);
                            if (useremail != null) {
                                console.log("if New Add task..." + i + ' . ' + taskList.title + '  - ' + useremail);
                                db.collection("tasks").add({
                                    uemail: useremail,
                                    title: taskList.title,
                                    dueDate: new Date(Date.parse(taskList.due)),
                                    dateAdded: new Date(),
                                    status: false
                                });
                            };
                        }
                document.getElementById("futuretasklog").innerHTML = 'Loaded Future Tasks > 360 days';
                    } else {
                        console.log('No task lists found.');
                document.getElementById("futuretasklog").innerHTML = 'NOT Loaded future tasks';
                    }
                },
                    function (err) { console.error("Execute error", err); });
        }
        
        gapi.load("client:auth2", function () {
            gapi.auth2.init({ client_id: "576657502351-qeak2lt68shslqidvrnbm2b12kjp21i1.apps.googleusercontent.com" });
        });
    </script>

</body>

</html>
